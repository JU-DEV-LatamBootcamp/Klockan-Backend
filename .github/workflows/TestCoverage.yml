  name: Test coverage

  on:
    push:
      branches:
        - develop
        
  jobs:
    test:
      runs-on: ubuntu-latest
      steps:
        - name: Checkout code
          uses: actions/checkout@v4
        - name: Change directory to KlockanAPI
          run: cd KlockanAPI
        - name: Set up .NET Core SDK
          uses: actions/setup-dotnet@v4
          with:
              dotnet-version: '8.0.x'
        - name: Restore dependencies
          run: dotnet restore
        - name: Build and run tests with coverage
          run: |
              dotnet test --collect:"XPlat Code Coverage" --results-directory ./TestResults /p:CollectCoverage=true /p:CoverletOutputFormat=cobertura /p:CoverletOutput=./TestResults/Coverage/
              reportgenerator -reports:"./TestResults/*/coverage.cobertura.xml" -targetdir:"./TestResults/CoverletReports" -reporttypes:"HtmlInline_AzurePipelines_Dark;Cobertura" -historydir:./TestResults
        - name: Upload coverage report
          uses: actions/upload-artifact@v2
          with:
            name: coverage-report
            path: ./TestResults/CoverletReports
